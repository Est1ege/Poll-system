#!/usr/bin/env python
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤ Django –ø—Ä–æ–µ–∫—Ç–∞
"""

import os
import subprocess
import sys
from pathlib import Path

def run_command(command, cwd=None):
    """–í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    try:
        result = subprocess.run(command, shell=True, cwd=cwd, capture_output=True, text=True)
        if result.returncode != 0:
            print(f"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã: {command}")
            print(f"–û—à–∏–±–∫–∞: {result.stderr}")
            return False
        return True
    except Exception as e:
        print(f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã {command}: {e}")
        return False

def update_translations():
    """–û–±–Ω–æ–≤–ª—è–µ—Ç –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤"""
    # –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
    project_path = Path(__file__).parent
    
    print("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤...")
    
    # 1. –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–æ–¥–∞
    print("üìù –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–æ–¥–∞...")
    if not run_command("python manage.py makemessages -l ru -l kk", cwd=project_path):
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π")
        return False
    
    # 2. –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã
    print("üî® –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤...")
    if not run_command("python manage.py compilemessages", cwd=project_path):
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤")
        return False
    
    print("‚úÖ –ü–µ—Ä–µ–≤–æ–¥—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
    return True

def add_new_translations():
    """–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –≤ —Ñ–∞–π–ª—ã .po"""
    print("üìã –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤...")
    
    # –°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    new_translations = {
        # –ù–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞
        "Share Poll": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –æ–ø—Ä–æ—Å–æ–º",
        "Share Link": "–°—Å—ã–ª–∫–∞ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞",
        "Copy": "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
        "Copied!": "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
        "Share on Social Media": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö",
        "Poll Statistics": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ä–æ—Å–∞",
        "Votes": "–ì–æ–ª–æ—Å–æ–≤",
        "Choices": "–í–∞—Ä–∏–∞–Ω—Ç–æ–≤",
        "Status": "–°—Ç–∞—Ç—É—Å",
        "Active": "–ê–∫—Ç–∏–≤–µ–Ω",
        "Closed": "–ó–∞–∫—Ä—ã—Ç",
        "View Poll": "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø—Ä–æ—Å",
        "Back to Polls": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–ø—Ä–æ—Å–∞–º",
        "Share": "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è",
        
        # –ù–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–æ–≤
        "Create New Poll": "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–ø—Ä–æ—Å",
        "Poll Information": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø—Ä–æ—Å–µ",
        "Answer Choices": "–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤",
        "Number of choices": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤",
        "Check this if this is a quiz with correct answers": "–û—Ç–º–µ—Ç—å—Ç–µ, –µ—Å–ª–∏ —ç—Ç–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏",
        "Allow users to discuss this poll": "–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–±—Å—É–∂–¥–∞—Ç—å —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å",
        "Create Poll": "–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å",
        "Enter your question here...": "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å...",
        "Optional description...": "–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...",
        "Correct answer": "–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç",
        "For a quiz, you must select at least one correct answer.": "–î–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.",
        
        # –ù–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
        "Personal Account": "–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç",
        "Welcome back": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å",
        "My Polls": "–ú–æ–∏ –æ–ø—Ä–æ—Å—ã",
        "Total Votes": "–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤",
        "Votes Given": "–û—Ç–¥–∞–Ω–æ –≥–æ–ª–æ—Å–æ–≤",
        "Days Registered": "–î–Ω–µ–π —Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "Username": "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "Email": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞",
        "Date Joined": "–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏",
        "Last Login": "–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥",
        "Recent Polls": "–ù–µ–¥–∞–≤–Ω–∏–µ –æ–ø—Ä–æ—Å—ã",
        "Created": "–°–æ–∑–¥–∞–Ω",
        "Profile": "–ü—Ä–æ—Ñ–∏–ª—å",
        "Logout": "–í—ã—Ö–æ–¥",
        
        # –û–±—â–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
        "Home": "–ì–ª–∞–≤–Ω–∞—è",
        "current": "—Ç–µ–∫—É—â–∞—è",
        "Polls": "–û–ø—Ä–æ—Å—ã",
        "Register": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
        "First": "–ü–µ—Ä–≤–∞—è",
        "Previous": "–ü—Ä–µ–¥—ã–¥—É—â–∞—è",
        "Next": "–°–ª–µ–¥—É—é—â–∞—è",
        "Last": "–ü–æ—Å–ª–µ–¥–Ω—è—è",
        "No polls found.": "–û–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.",
        "Poll Detail": "–î–µ—Ç–∞–ª–∏ –æ–ø—Ä–æ—Å–∞",
        "Back to Polls": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–ø—Ä–æ—Å–∞–º",
        "Search": "–ü–æ–∏—Å–∫",
        "Name": "–ò–º—è",
        "Date": "–î–∞—Ç–∞",
        "Vote": "–ì–æ–ª–æ—Å",
        "Are you sure?": "–í—ã —É–≤–µ—Ä–µ–Ω—ã?",
        "End Poll": "–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–æ—Å",
        "Edit": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
        "Delete": "–£–¥–∞–ª–∏—Ç—å",
        "Add": "–î–æ–±–∞–≤–∏—Ç—å",
        "Update": "–û–±–Ω–æ–≤–∏—Ç—å",
        "Cancel": "–û—Ç–º–µ–Ω–∞",
        "Close": "–ó–∞–∫—Ä—ã—Ç—å",
        "Welcome to Polls List!": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –æ–ø—Ä–æ—Å–æ–≤!",
        "Welcome to polls List!": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –æ–ø—Ä–æ—Å–æ–≤!",
        "Poll & Choices added successfully.": "–û–ø—Ä–æ—Å –∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã.",
        "Poll updated successfully.": "–û–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω.",
        "Poll deleted successfully.": "–û–ø—Ä–æ—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.",
        "Choice added successfully.": "–í–∞—Ä–∏–∞–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω.",
        "Choice updated successfully.": "–í–∞—Ä–∏–∞–Ω—Ç —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω.",
        "Choice deleted successfully.": "–í–∞—Ä–∏–∞–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.",
        "No choice selected!": "–í–∞—Ä–∏–∞–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω!",
        "You already voted this poll!": "–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –≤ —ç—Ç–æ–º –æ–ø—Ä–æ—Å–µ!",
        "This is a quiz": "–≠—Ç–æ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞",
        "Update choice": "–ò–∑–º–µ–Ω–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç",
        "Add new choice": "–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç",
        "Create new poll": "–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å",
        "Edit poll": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–æ—Å",
        "Add Choice": "–î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç",
        "Choices": "–í–∞—Ä–∏–∞–Ω—Ç—ã",
        "Result for: %(poll.text)s": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è: %(poll.text)s",
        "Result for: %(text)s": "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è: %(text)s",
        "\"%(text)s\" Has Ended Polling!": "\"%(text)s\" –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!",
        "Total: %(total)s votes": "–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: %(total)s",
        "%(name)s ‚Äî %(percent)s%%": "%(name)s ‚Äî %(percent)s%%",
        "%(name|truncatewords:2)s ‚Äî %(percent)s%%": "%(name|truncatewords:2)s ‚Äî %(percent)s%%",
        "Back To Polls": "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–ø—Ä–æ—Å–∞–º",
        "Polls details page": "–°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–ø—Ä–æ—Å–∞",
        "Vote now": "–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å",
        "Login": "–í–æ–π—Ç–∏",
        "Don't have an account?": "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?",
        "Sign Up": "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
        "Already have an account?": "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?",
        "Login Here": "–í–æ–π—Ç–∏",
        "English": "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π",
        "–†—É—Å—Å–∫–∏–π": "–†—É—Å—Å–∫–∏–π",
        "“ö–∞–∑–∞“õ—à–∞": "–ö–∞–∑–∞—Ö—Å–∫–∏–π",
    }
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ä—É—Å—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥
    ru_po_path = Path("locale/ru/LC_MESSAGES/django.po")
    if ru_po_path.exists():
        print(f"üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ {ru_po_path}...")
        update_po_file(ru_po_path, new_translations)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∑–∞—Ö—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥
    kk_po_path = Path("locale/kk/LC_MESSAGES/django.po")
    if kk_po_path.exists():
        print(f"üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ {kk_po_path}...")
        # –î–ª—è –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
        pass

def update_po_file(po_path, translations):
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∞–π–ª .po –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏"""
    try:
        with open(po_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞
        new_content = ""
        for msgid, msgstr in translations.items():
            if f'msgid "{msgid}"' not in content:
                new_content += f'\nmsgid "{msgid}"\nmsgstr "{msgstr}"\n'
        
        if new_content:
            with open(po_path, 'a', encoding='utf-8') as f:
                f.write(new_content)
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(translations)} –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –≤ {po_path}")
        else:
            print(f"‚ÑπÔ∏è –í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ {po_path}")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ {po_path}: {e}")

if __name__ == "__main__":
    print("üöÄ –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤...")
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã
    add_new_translations()
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–≤–æ–¥—ã
    if update_translations():
        print("üéâ –í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!")
    else:
        print("üí• –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤")
        sys.exit(1) 